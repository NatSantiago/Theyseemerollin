"use strict";(function(){var e,a,_,c,r,v,h,t,u,o,l,i;e=window.wp,a=jQuery,e&&e.customize&&(_=e.customize,h=wc_voucher_template_preview,t=function(){var e=_("wc_voucher_template_voucher_primary_image").get(),u=a("#voucher-image img");return e.width!==u.width()?h.image_scale=u.width()/e.width:h.image_scale=1,l("voucher",v(_("wc_voucher_template_voucher_font_size").get())),a.each(h.voucher_fields,function(e,t){var r,i,n,o,c=a("#voucher #"+t);return""!==u.attr("src")&&(o=(o=_("wc_voucher_template_"+t+"_pos").get())?o.split(",").map(function(e){return parseInt(e,10)*h.image_scale}):null)?(n={left:o[0]+"px",top:o[1]+"px",width:o[2]+"px",height:o[3]+"px"},c.css(n).show(),r=null,(i=_("wc_voucher_template_"+t+"_font_size"))&&(r=i.get()),r?l(t,v(r)):void 0):c.hide()})},v=function(e){return e*(_("wc_voucher_template_voucher_image_dpi").get()/72*h.image_scale)},l=function(e,t){var r=h.css_config.font_size;return o(e,r,t)},o=function(e,t,r){var i=r?t.value.replace("{$value}",r):"";return a("#"+e).css(t.property,i)},u=function(){return a("#voucher-image img").imgAreaSelect({remove:!0}),t()},i=function(r,e){var t,i,n,o=1<arguments.length&&void 0!==e?e:null;if(a("#voucher-image img").attr("src"))return u(),a("#voucher #"+r).hide(),n=_("wc_voucher_template_"+r+"_pos").get(),i=_("wc_voucher_template_voucher_primary_image").get(),t=n?n.split(",").map(function(e){return parseInt(e,10)}):[null,null,null,null],a("#voucher-image img").imgAreaSelect({show:!0,handles:!0,instance:!0,imageWidth:i.width,imageHeight:i.height,x1:t[0],y1:t[1],x2:t[0]+t[2],y2:t[1]+t[3],aspectRatio:o,onSelectEnd:function(e,t){c(t,r)}})},c=function(e,t){var r=[e.x1,e.y1,e.width,e.height];return _.preview.send("voucher:update-position:"+t,r.join(","))},r=function(n){if(h.css_config)return a.each(h.css_config,function(t,r){var i;if(r.property)return r.value||(r.value="{$value}"),i=function(e){return"font_size"===t&&(e=(e="0"===e?null:e)&&v(e)),o(n,r,e)},_("wc_voucher_template_"+n+"_"+t,function(e){return i(e.get()),e.bind(i)})})},_("wc_voucher_template_voucher_primary_image",function(e){return e.bind(function(e){return a("#voucher-image img").prop("src",e.src).load(function(){return e.src?a("body").removeClass("voucher-no-image"):a("body").addClass("voucher-no-image"),t()})})}),_("wc_voucher_template_voucher_additional_image",function(e){return e.bind(function(e){return a("#voucher-additional-image img").prop("src",e)})}),_("wc_voucher_template_voucher_image_dpi",function(e){return e.bind(t)}),a(function(){return _.preview.bind("voucher:start-positioning",function(e){return i(e.field_id,e.aspect_ratio)}),_.preview.bind("voucher:stop-positioning",function(e){return u()}),_.preview.bind("voucher:remove-position",function(e){return t()}),_.preview.bind("voucher:update-position",function(e){return console.log("update...",e),t()}),a(window).resize(t),setTimeout(function(){return t(),r("voucher"),a.each(h.voucher_fields,function(e,t){return r(t)})},0),a("#voucher").click(".js-voucher-field-pos",function(e){return _.preview.send("voucher:click-position:"+e.target.id)})}))}).call(void 0);